<!DOCTYPE html>
<html lang='en'><head>
  <meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='description' content='Recently I wrote a post where I was running a GUI application in a docker container. I did so because I couldn&#8217;t be confident of the software&#8217;s origins and thought it&#8217;d be best not to take any chances. What other potential exploits does this leave one vulnerable to and how can one best protect themselves?
But isn&#8217;t everything running in Docker secure? First things first, let&#8217;s talk about what kind of security assurances docker tries to provide and under what circumstances those assurances would be considered null and void.'>
<meta name='theme-color' content='#ffcd00'>

<meta property='og:title' content='Docker Security Risks: GUIs &#43; Xorg • Geek w/ god complex'>
<meta property='og:description' content='Recently I wrote a post where I was running a GUI application in a docker container. I did so because I couldn&#8217;t be confident of the software&#8217;s origins and thought it&#8217;d be best not to take any chances. What other potential exploits does this leave one vulnerable to and how can one best protect themselves?
But isn&#8217;t everything running in Docker secure? First things first, let&#8217;s talk about what kind of security assurances docker tries to provide and under what circumstances those assurances would be considered null and void.'>
<meta property='og:url' content='http://blog.nicro.land/p496/'>
<meta property='og:site_name' content='Geek w/ god complex'>
<meta property='og:type' content='article'><meta property='article:section' content='posts'><meta property='article:tag' content='docker'><meta property='article:tag' content='security'><meta property='article:published_time' content='2016-02-27T11:39:47Z'/><meta property='article:modified_time' content='2016-02-27T11:39:47Z'/><meta name='twitter:card' content='summary'>

<meta name="generator" content="Hugo 0.54.0" />

  <title>Docker Security Risks: GUIs &#43; Xorg • Geek w/ god complex</title>
  <link rel='canonical' href='http://blog.nicro.land/p496/'>
  
  
  <link rel='icon' href='/favicon.ico'>
<link rel='stylesheet' href='/assets/css/main.4a10984a.css'><link rel='stylesheet' href='/css/custom.css'><style>
:root{--color-accent:#ffcd00;}
</style>

  

</head>
<body class='page type-post has-sidebar'>

  <div class='site'><div id='sidebar' class='sidebar'>
  <a class='screen-reader-text' href='#main-menu'>Skip to Main Menu</a>

  <div class='container'><section class='widget widget-about sep-after'>
  <header>
    
    <div class='logo'>
      <a href='/'>
        <img src='/images/shocked-circle.png'>
      </a>
    </div>
    
    <h2 class='title site-title '>
    Nic Roland
    </h2>
    <div class='desc'>
    
    </div>
  </header>

</section>
<section class='widget widget-sidebar_menu sep-after'><nav id='sidebar-menu' class='menu sidebar-menu' aria-label='Sidebar Menu'>
    <div class='container'>
      <ul><li class='item'>
  <a href='/about/'>About</a></li><li class='item'>
  <a href='/posts/'>Posts</a></li><li class='item'>
  <a href='http://slides.nicro.land'>Slides</a></li></ul>
    </div>
  </nav>

</section><section class='widget widget-taxonomy_cloud sep-after'>
  <header>
    <h4 class='title widget-title'>Tags</h4>
  </header>

  <div class='container list-container'>
  <ul class='list taxonomy-cloud'><li>
        <a href='/tags/python/' style='font-size:1.5em'>Python</a>
      </li><li>
        <a href='/tags/compose/' style='font-size:1em'>compose</a>
      </li><li>
        <a href='/tags/docker/' style='font-size:2em'>docker</a>
      </li><li>
        <a href='/tags/golang/' style='font-size:1em'>golang</a>
      </li><li>
        <a href='/tags/lifehacks/' style='font-size:1.5em'>lifehacks</a>
      </li><li>
        <a href='/tags/linux/' style='font-size:1.5em'>linux</a>
      </li><li>
        <a href='/tags/machine/' style='font-size:1em'>machine</a>
      </li><li>
        <a href='/tags/openshift/' style='font-size:1em'>openshift</a>
      </li><li>
        <a href='/tags/rpm.spec/' style='font-size:1em'>rpm.spec</a>
      </li><li>
        <a href='/tags/security/' style='font-size:1em'>security</a>
      </li><li>
        <a href='/tags/setup.py/' style='font-size:1em'>setup.py</a>
      </li></ul>
</div>


</section>
</div>

  <div class='sidebar-overlay'></div>
</div><div class='main'><a class='screen-reader-text' href='#content'>Skip to Content</a>

<button id='sidebar-toggler' class='sidebar-toggler' aria-controls='sidebar'>
  <span class='screen-reader-text'>Toggle Sidebar</span>
  <span class='open'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="3" y1="12" x2="21" y2="12" />
  <line x1="3" y1="6" x2="21" y2="6" />
  <line x1="3" y1="18" x2="21" y2="18" />
  
</svg>
</span>
  <span class='close'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="18" y1="6" x2="6" y2="18" />
  <line x1="6" y1="6" x2="18" y2="18" />
  
</svg>
</span>
</button><div class='header-widgets'>
        <div class='container'></div>
      </div>

      <header id='header' class='header site-header'>
        <div class='container sep-after'>
          <div class='header-info'><p class='site-title title'>Geek w/ god complex</p><p class='desc site-desc'>and his senseless ramblings...</p>
          </div>
        </div>
      </header>

      <main id='content'>


<article lang='en' class='entry'>
  <header class='header entry-header'>
  <div class='container sep-after'>
    <div class='header-info'>
      <h1 class='title'>Docker Security Risks: GUIs &#43; Xorg</h1>
      

    </div>
    <div class='entry-meta'>
  <span class='posted-on'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
  <line x1="16" y1="2" x2="16" y2="6"/>
  <line x1="8" y1="2" x2="8" y2="6"/>
  <line x1="3" y1="10" x2="21" y2="10"/>
  
</svg>
<span class='screen-reader-text'>Posted on </span>
  <time class='entry-date' datetime='2016-02-27T11:39:47Z'>27 Feb 2016</time>
</span>

  
  
<span class='reading-time'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <circle cx="12" cy="12" r="10"/>
  <polyline points="12 6 12 12 15 15"/>
  
</svg>
6 mins read
</span>


</div>


  </div>
</header>

  
  

  <div class='container entry-content'>
  

<p>Recently I <a href="http://blog.nicro.land/p87/" target="_blank">wrote a post</a> where I was running a GUI application in a docker container. I did so because I couldn&#8217;t be confident of the software&#8217;s origins and thought it&#8217;d be best not to take any chances. What other potential exploits does this leave one vulnerable to and how can one best protect themselves?</p>

<p><img class="alignnone size-full wp-image-833" src="/wp-content/uploads/2016/02/docker_and_xorg2.png" alt="docker_and_xorg" width="2000" height="901" srcset="/wp-content/uploads/2016/02/docker_and_xorg2.png 2000w, /wp-content/uploads/2016/02/docker_and_xorg2-300x135.png 300w, /wp-content/uploads/2016/02/docker_and_xorg2-768x346.png 768w, /wp-content/uploads/2016/02/docker_and_xorg2-1024x461.png 1024w" sizes="(max-width: 767px) 89vw, (max-width: 1000px) 54vw, (max-width: 1071px) 543px, 580px" /></p>

<h2 id="but-isn-8217-t-everything-running-in-docker-secure">But isn&#8217;t everything running in Docker secure?</h2>

<p>First things first, let&#8217;s talk about what kind of security assurances docker tries to provide and under what circumstances those assurances would be considered null and void.</p>

<p>One of the major selling points of containers is the various forms of isolation that they provide (here&#8217;s Solomon&#8217;s <a href="http://www.slideshare.net/Docker/dockercon-eu-day-1-general-session/84" target="_blank">list from DockerConEu</a>). Docker&#8217;s strategy is to lock down as many avenues between containers and the host as it can. From here it lets you decide whether or not your application needs them and lets you open some of these avenues at your discretion.</p>

<p>This means that you&#8217;re free to provide containers with access to things like <em>/var/run/docker.sock</em> which means they can control the docker engine running on the host. People do this all the time, e.g., if they&#8217;re running Continuous Integration software inside a container that wants to execute build plans in other containers. That doesn&#8217;t mean that it&#8217;s particularly safe if you don&#8217;t trust code running in those build plans. Processes in these containers could use this to become root on the host (here&#8217;s a <a href="http://www.slideshare.net/gvarisco/road-to-opscon-pisa-15-devooops/54" target="_blank">pretty succinct explanation</a> of how this works), although it&#8217;s my understanding that the new <a href="https://blog.docker.com/2016/02/docker-engine-1-10-security/" target="_blank">support for user namespaces</a> in Docker 1.10 nips this in the bud.</p>

<p>This brings me back to running  GUI applications in Docker. To display the GUI they need to be able to talk to the X server (Xorg) running on your host through a socket file; _/tmp/.X11-unix._ This also provides it with access to a smorgasbord of things that it can use against you.</p>

<p>The problem is that Xorg is in charge of more than just what gets displayed on the screen, it also handles input from keyboard/mouse. It does have a security layer but it&#8217;s kinda tacked on and doesn&#8217;t support fine grain control over which resources are accessible.</p>

<h2 id="what-can-i-do-about-it">What can I do about it?</h2>

<p>So how do we know when access to certain resources is a bad idea? I don&#8217;t believe it&#8217;s an exaggeration to say that every piece of software that serves a practical purpose also comes with potential security implications. Security omniscience (knowing every facet of the software we run, understanding how it relates to security and how these facets interrelate) is impractical, for this reason security omnipotence (the power to be 100% secure) is impossible.</p>

<p>The best we can do is to constantly seek clarity on what it is that our software does and (if at all possible) how it does it. I&#8217;ve found that as a result of adopting this policy, an intuition regarding security will naturally begin to develop. It all boils down to this: never stop asking questions.</p>

<p>So the next question to ask is&#8230;</p>

<h2 id="how-can-i-fuck-over-the-end-user">How can I fuck over the end-user?</h2>

<p>After poking around for a bit I realised that containers with access to Xorg could indeed do some scary things (at least while the container was still running.)</p>

<p>So I decided I&#8217;d throw together a few demos of containers that spy on/manipulate their host. These are really basic! They&#8217;re purely to remind you that just because you&#8217;re running something in a container doesn&#8217;t mean you&#8217;re not exposed to potential attacks.</p>

<h3 id="screenshots">Screenshots</h3>

<p>Imagemagik is used a lot on Linux to take screenshots and it does this by interacting with X. Ergo; if your container has access to X on the host, than it can screenshot the host (and without any particular form of warning).</p>

<p>Here&#8217;s a demo dockerfile that screenshots with imagemagik and displays the resulting image with feh:</p>

<script src="https://gist.github.com/nicr9/b239a57f9cc93151cc73.js"></script>

<p>Here&#8217;s the commands needed to get this working:</p>

<script src="https://gist.github.com/nicr9/5950d050744c24a1d7ff.js"></script>

<p>You&#8217;ll notice that the only additional things this container needs is to tell xhost to allow any access from localhost, to mount the X socket and the provide the display number. These are all things you would need to do to allow any GUI to run from the confines of a container.</p>

<h3 id="toggling-capslock-every-20-minutes">Toggling capslock every 20 minutes</h3>

<p>This example installs xdotool which can be used for (among other things) simulating keypresses. Then it creates a cron that uses xdotool to toggle caps lock every 20 minutes.</p>

<p>Clearly I&#8217;m some kind of deranged lunatic for coming up with something this nefarious. Use responsibly.</p>

<script src="https://gist.github.com/nicr9/55a6f2ac73cdf3bf33f9.js"></script>

<p>Pretty much the same docker commands for running this container so I won&#8217;t bother including those from now on.</p>

<h3 id="peeking-at-the-clipboard">Peeking at the clipboard</h3>

<p>This one is ridiculously easy! Xclip is a tool for read and write access to the various clipboards provided by X. That includes the regular clipboard (Ctrl+c/Ctrl+v), used in the example here, as well as the selection clipboard (highlight/middle mouse button) if you&#8217;re on Linux.</p>

<script src="https://gist.github.com/nicr9/989836942f582ce17610.js"></script>

<h3 id="scripting-mouse-movements">Scripting mouse movements</h3>

<p>Our old friend xdotool can also be used to script mouse movements! Here&#8217;s an example of it moving to certain co-ordinates (15, 15) and clicking, it&#8217;s just a minor modification of the capslock example:</p>

<script src="https://gist.github.com/nicr9/d0d703185da4bc21e471.js"></script>

<p>On it&#8217;s own this could be fairly random and useless but if we were to combine this with the screenshots we took above, we could get a reasonable idea of where we&#8217;d like to click to cause the most damage.</p>

<h3 id="what-else">What else?</h3>

<p>We could go further and grant access to other stuff like /dev/input/* (log data from keyboard + mouse), /dev/snd (speakers + microphones) or /dev/video0 (web cams). The possibilities are endless.</p>

<p>With all of this we could put together a <a href="https://www.google.ie/search?q=remote+access+trojan" target="_blank">RAT</a>!&#8230; But at the risk of being put on some kinda watch-list, I think I&#8217;ll just leave that as an exercise for the reader&#8230;</p>

<h2 id="conclusions">Conclusions</h2>

<p>The purpose of this article is to inform you of what you&#8217;re opening yourself up to when running GUIs in containers. Don&#8217;t do it when you&#8217;re working on anything sensitive on the host!</p>

<p>If you don&#8217;t actually need to interact with the GUI itself (maybe you&#8217;re considering your testing options) then you might get some of the benefits of containerisation by running these applications headless (a lot of people <a href="http://agiletesting.blogspot.ie/2016/01/running-headless-selenium-webdriver.html" target="_blank">containerise Selenium tests</a> this way).</p>

<p><strong>Silver lining</strong>: Programs running in containers need a some kind of exploit to escape the confines of that container (like the /var/run/docker.sock thing I talked about at the beginning). This means that most of the time we can be assured that as soon as we stop the container running our hypothetical RAT, it will be unable to continue spying on us (it&#8217;s the equivalent of pulling the plug.)</p>

</div>

  
<footer class='entry-footer'>
  <div class='container sep-before'><div class='categories'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M22,19a2,2,0,0,1-2,2H4a2,2,0,0,1-2-2V5A2,2,0,0,1,4,3H9l2,3h9a2,2,0,0,1,2,2Z"/>
  
</svg>
<span class='screen-reader-text'>Categories: </span><a class='category' href='/categories/uncategorised/'>Uncategorised</a></div>
<div class='tags'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M20.59,13.41l-7.17,7.17a2,2,0,0,1-2.83,0L2,12V2H12l8.59,8.59A2,2,0,0,1,20.59,13.41Z"/>
  <line x1="7" y1="7" x2="7" y2="7"/>
  
</svg>
<span class='screen-reader-text'>Tags: </span><a class='tag' href='/tags/docker/'>docker</a>, <a class='tag' href='/tags/security/'>security</a></div>

  </div>
</footer>


</article>

<nav class='entry-nav'>
  <div class='container'><div class='prev-entry sep-before'>
      <a href='/p555/'>
        <span aria-hidden='true'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="20" y1="12" x2="4" y2="12"/>
  <polyline points="10 18 4 12 10 6"/>
  
</svg>
 Previous</span>
        <span class='screen-reader-text'>Previous post: </span>Nested decorator functions in Python</a>
    </div><div class='next-entry sep-before'>
      <a href='/p992/'>
        <span class='screen-reader-text'>Next post: </span>A Markdown notes server<span aria-hidden='true'>Next <svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="4" y1="12" x2="20" y2="12"/>
  <polyline points="14 6 20 12 14 18"/>
  
</svg>
</span>
      </a>
    </div></div>
</nav>




      </main>

      <footer id='footer' class='footer'>
        <div class='container sep-before'><section class='widget widget-social_menu sep-after'><nav aria-label='Social Menu'>
    <ul><li>
        <a href='https://github.com/nicr9' target='_blank' rel='noopener'>
          <span class='screen-reader-text'>Open Github account in new tab</span><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
  
</svg>
</a>
      </li><li>
        <a href='https://twitter.com/nicr9_' target='_blank' rel='noopener'>
          <span class='screen-reader-text'>Open Twitter account in new tab</span><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/>
  
</svg>
</a>
      </li><li>
        <a href='mailto:nicroland9@gmail.com' target='_blank' rel='noopener'>
          <span class='screen-reader-text'>Contact via Email</span><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
  <polyline points="22,6 12,13 2,6"/>
  
</svg>
</a>
      </li><li>
        <a href='https://linkedin.com/in/nicroland' target='_blank' rel='noopener'>
          <span class='screen-reader-text'>Open Linkedin account in new tab</span><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"/>
  <rect x="2" y="9" width="4" height="12"/>
  <circle cx="4" cy="4" r="2"/>
  
</svg>
</a>
      </li></ul>
  </nav>
</section><div class='copyright'>
  <p> &copy; 2017-2019 Nic Roland </p>
</div>

        </div>
      </footer>

    </div>
  </div><script>window.__public_path__='\/assets\/js\/'</script>

<script src='/assets/js/main.fae8ed32.js'></script><script src='/js/custom.js'></script>

</body>

</html>

